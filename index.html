<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <link rel="apple-touch-icon" href="IMG_3634.png">
    <title>HydroTrack Liquid</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = { darkMode: 'class' }
    </script>
    <style>
        /* --- ANIMACJE I PRZEJ≈öCIA --- */
        body { transition: background-color 0.5s ease, color 0.5s ease; }
        
        /* --- T≈ÅO LIGHT / DARK --- */
        body { background-color: #f0f4ff; color: #1d1d1f; }
        body.dark { background-color: #050505; color: #ffffff; }

        .blob { filter: blur(60px); mix-blend-mode: multiply; opacity: 0.4; transition: all 0.5s; }
        body.dark .blob { mix-blend-mode: normal; opacity: 0.25; filter: blur(80px); }

        /* --- LIQUID GLASS --- */
        .liquid-glass {
            background: rgba(255, 255, 255, 0.3);
            backdrop-filter: blur(40px) saturate(180%);
            -webkit-backdrop-filter: blur(40px) saturate(180%);
            border: 1px solid rgba(255, 255, 255, 0.4);
            box-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.1), inset 0 0 0 1px rgba(255, 255, 255, 0.1);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        body.dark .liquid-glass {
            background: rgba(40, 40, 40, 0.3);
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 10px 40px 0 rgba(0, 0, 0, 0.6), inset 0 0 0 1px rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(40px) saturate(200%);
            -webkit-backdrop-filter: blur(40px) saturate(200%);
        }
        .liquid-glass:active { transform: scale(0.95); }

        /* --- SELECTS --- */
        select { 
            -webkit-appearance: none; appearance: none; background-color: transparent; 
            text-align: center; text-align-last: center; font-weight: bold; width: 100%; height: 100%;
        }
        option { color: black; }

        /* --- PASEK (TUBE) --- */
        .glass-tube {
            background: rgba(255, 255, 255, 0.15);
            border: 1px solid rgba(255, 255, 255, 0.3);
            box-shadow: inset 0 0 20px rgba(255, 255, 255, 0.2);
        }
        body.dark .glass-tube {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.15);
            box-shadow: inset 0 0 20px rgba(255, 255, 255, 0.05);
        }

        /* --- SHEET --- */
        .sheet {
            transform: translateY(110%); transition: transform 0.5s cubic-bezier(0.32, 0.72, 0, 1);
            background: rgba(250, 250, 250, 0.9); backdrop-filter: blur(50px) saturate(180%);
            border-top: 1px solid rgba(255,255,255,0.6); box-shadow: 0 -10px 40px rgba(0,0,0,0.1); color: #1d1d1f;
        }
        body.dark .sheet {
            background: rgba(25, 25, 25, 0.85); border-top: 1px solid rgba(255,255,255,0.15); color: white;
            box-shadow: 0 -10px 50px rgba(0,0,0,0.5);
        }
        .sheet.show { transform: translateY(0); }
        .no-scrollbar::-webkit-scrollbar { display: none; } .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }

        /* --- SWITCH (Toggle) --- */
        .toggle-checkbox:checked { right: 0; border-color: #68D391; }
        .toggle-checkbox:checked + .toggle-label { background-color: #34C759; }
        .toggle-label { width: 50px; height: 30px; border-radius: 9999px; transition: background-color 0.2s ease-in-out; }
        .toggle-circle { top: 2px; left: 2px; width: 26px; height: 26px; border-radius: 50%; transition: transform 0.2s ease-in-out; }
        .toggle-checkbox:checked + .toggle-label .toggle-circle { transform: translateX(20px); }

        /* --- WYKRES S≈ÅUPKOWY --- */
        .chart-bar-bg { background: rgba(0,0,0,0.05); border-radius: 4px; overflow: hidden; }
        body.dark .chart-bar-bg { background: rgba(255,255,255,0.1); }
        .chart-fill { background: #007AFF; transition: height 1s ease; border-radius: 4px; }
        body.dark .chart-fill { background: #409CFF; }
        
        .text-accent { color: #007AFF; } body.dark .text-accent { color: #409CFF; }
        .text-sub { color: #64748b; } body.dark .text-sub { color: #94a3b8; }
    </style>
</head>
<body class="flex flex-col items-center h-screen font-sans overflow-hidden relative selection:bg-blue-200">

    <div class="fixed inset-0 -z-10 overflow-hidden pointer-events-none bg-inherit transition-colors duration-500">
        <div class="blob absolute top-[-10%] left-[-10%] w-[500px] h-[500px] bg-blue-400 rounded-full animate-blob"></div>
        <div class="blob absolute top-[-10%] right-[-10%] w-[500px] h-[500px] bg-purple-400 rounded-full animate-blob animation-delay-2000"></div>
        <div class="blob absolute bottom-[-20%] left-[20%] w-[600px] h-[600px] bg-indigo-400 rounded-full animate-blob animation-delay-4000"></div>
    </div>

    <div id="clock" class="absolute top-6 left-1/2 -translate-x-1/2 font-medium text-xs tracking-wide opacity-50 mix-blend-difference text-white">00:00</div>

    <button onclick="toggleTheme()" class="liquid-glass w-12 h-12 rounded-full flex items-center justify-center text-current absolute left-6 top-16 z-20 shadow-lg transition-colors">
        <svg id="theme-icon" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" class="w-6 h-6"></svg>
    </button>

    <button onclick="toggleHistory()" class="liquid-glass w-12 h-12 rounded-full flex items-center justify-center text-current absolute right-6 top-16 z-20 shadow-lg">
        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" class="w-6 h-6"><path stroke-linecap="round" stroke-linejoin="round" d="M12 6v6h4.5m4.5 0a9 9 0 11-18 0 9 9 0 0118 0z" /></svg>
    </button>

    <button onclick="setGoal()" class="liquid-glass px-6 py-3 rounded-full font-semibold text-sm mt-32 mb-4 z-10 flex items-center gap-2 text-current">
        <span class="opacity-70">CEL:</span> <span id="display-goal" class="font-bold">2500</span> <span>ml</span>
    </button>

    <div class="flex-grow flex flex-col justify-center items-center w-full relative z-0 gap-6">
        <div class="glass-tube relative w-24 h-[35vh] rounded-[40px] overflow-hidden drop-shadow-2xl">
            <div id="progress-fill" class="absolute bottom-0 left-0 right-0 bg-gradient-to-t from-[#007AFF] to-[#5AC8FA] w-full transition-all duration-1000 ease-[cubic-bezier(0.34,1.56,0.64,1)] shadow-[0_0_30px_rgba(0,122,255,0.4)]" style="height: 0%"></div>
            <div class="absolute inset-0 bg-gradient-to-r from-white/20 to-transparent pointer-events-none"></div>
        </div>
        <div class="text-center z-10">
            <div class="text-6xl font-thin tracking-tighter drop-shadow-sm text-current"><span id="total">0</span></div>
            <div class="text-sub uppercase tracking-[0.2em] text-[10px] font-semibold mt-1">ml nawodnienia</div>
            <div class="mt-2 text-3xl font-bold text-accent drop-shadow-sm"><span id="percent-display">0</span>%</div>
        </div>
    </div>

    <div class="flex items-center justify-between w-full max-w-[320px] mb-12 px-2 z-20 gap-5">
        <div class="relative w-[76px] h-[76px]">
            <select id="amount-select" onchange="checkCustomAmount(this)" class="liquid-glass w-full h-full rounded-full text-accent text-xl outline-none cursor-pointer font-bold">
                <option value="100">100</option><option value="250" selected>250</option><option value="330">330</option><option value="500">500</option><option value="1000">1000</option><option value="custom">‚úé</option>
            </select>
            <span class="absolute bottom-3 left-0 right-0 text-center text-[9px] text-sub font-bold uppercase tracking-wide pointer-events-none">ML</span>
        </div>

        <button onclick="addDrink()" class="liquid-glass w-24 h-24 rounded-full flex items-center justify-center text-accent shadow-2xl hover:scale-105 transition duration-300">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-12 h-12"><path stroke-linecap="round" stroke-linejoin="round" d="M12 4.5v15m7.5-7.5h-15" /></svg>
        </button>

        <div class="relative w-[76px] h-[76px] liquid-glass rounded-full flex items-center justify-center">
            <span id="beverage-icon-display" class="text-3xl pointer-events-none">üíß</span>
            <select id="beverage" onchange="updateIconDisplay(); checkAutoAdd();" class="absolute inset-0 w-full h-full opacity-0 cursor-pointer">
                <optgroup label="Napoje">
                    <option value="1.0">üíß Woda</option><option value="0.9">üßÉ Sok</option><option value="0.85">‚òï Kawa</option><option value="1.0">‚òïü•õ Kawa z mlek.</option>
                    <option value="1.15">ü•• Woda Koko</option><option value="1.15">ü•õ Mleko</option><option value="0.9">‚ö° Energetyk</option>
                    <option value="0.9">ü•§ CocaCola</option><option value="0.98">üçµ Herbata</option><option value="0.6">üç∏ Alkohol</option>
                </optgroup>
                <optgroup label="Owoce (Auto ML)">
                    <option value="fruit-banana" data-ml="90">üçå Banan</option><option value="fruit-mandarin" data-ml="65">üçä Mandarynka</option>
                    <option value="fruit-kiwi" data-ml="60">ü•ù Kiwi</option><option value="fruit-apple" data-ml="150">üçé Jab≈Çko</option>
                    <option value="fruit-watermelon" data-ml="200">üçâ Arbuz</option><option value="fruit-pineapple" data-ml="140">üçç Ananas</option>
                </optgroup>
            </select>
        </div>
    </div>

    <div id="overlay" onclick="closeHistory()" class="fixed inset-0 bg-black/20 hidden backdrop-blur-[2px] z-40 transition-opacity duration-300"></div>

    <div id="history-sheet" class="sheet fixed bottom-0 left-0 right-0 h-[85vh] z-50 px-5 pb-10 pt-4 rounded-t-[36px] flex flex-col">
        <div class="w-10 h-1 bg-black/10 dark:bg-white/10 rounded-full mx-auto mb-4 flex-shrink-0"></div>
        
        <div class="flex justify-between items-center mb-4 px-2">
            <h2 class="font-bold text-2xl">Podsumowanie</h2>
            <span class="text-sub text-sm font-medium" id="history-date">Data</span>
        </div>

        <div class="bg-white/40 dark:bg-white/5 backdrop-blur-md rounded-[20px] p-4 mb-4 border border-white/40 dark:border-white/10 shadow-sm flex-shrink-0">
            <div class="text-xs text-sub font-bold uppercase mb-2">Ostatnie 7 dni</div>
            <div class="flex justify-between items-end h-24 gap-2" id="weekly-chart">
                </div>
        </div>

        <h3 class="font-bold text-lg mb-2 px-2">Dzisiejsze wpisy</h3>
        <div id="history-list" class="flex-grow overflow-y-auto no-scrollbar space-y-3 pb-2"></div>

        <div class="bg-white/40 dark:bg-white/5 backdrop-blur-md rounded-[20px] p-4 mt-2 mb-2 border border-white/40 dark:border-white/10 shadow-sm flex justify-between items-center flex-shrink-0">
            <div class="flex items-center gap-3">
                <span class="text-xl">üîî</span>
                <span class="font-bold">Powiadomienia</span>
            </div>
            <div class="relative inline-block w-12 h-7 align-middle select-none transition duration-200 ease-in">
                <input type="checkbox" name="toggle" id="notif-toggle" class="toggle-checkbox absolute block w-6 h-6 rounded-full bg-white border-4 appearance-none cursor-pointer" style="top:2px; left:2px; transition: all 0.3s;" onchange="toggleNotifications()"/>
                <label for="notif-toggle" class="toggle-label block overflow-hidden h-7 rounded-full bg-gray-300 cursor-pointer dark:bg-gray-600"></label>
            </div>
        </div>

        <div class="pt-2 border-t border-black/5 dark:border-white/10 flex-shrink-0 space-y-3">
            <button onclick="resetAll()" class="w-full bg-[#FF3B30]/10 text-[#FF3B30] py-4 rounded-[20px] font-bold text-lg active:scale-98 transition flex items-center justify-center gap-2">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" class="w-5 h-5"><path stroke-linecap="round" stroke-linejoin="round" d="M14.74 9l-.346 9m-4.788 0L9.26 9m9.968-3.21c.342.052.682.107 1.022.166m-1.022-.165L18.16 19.673a2.25 2.25 0 01-2.244 2.077H8.084a2.25 2.25 0 01-2.244-2.077L4.772 5.79m14.456 0a48.108 48.108 0 00-3.478-.397m-12 .562c.34-.059.68-.114 1.022-.165m0 0a48.11 48.11 0 013.478-.397m7.5 0v-.916c0-1.18-.91-2.164-2.09-2.201a51.964 51.964 0 00-3.32 0c-1.18.037-2.09 1.022-2.09 2.201v.916m7.5 0a48.667 48.667 0 00-7.5 0" /></svg>
                Zresetuj dzie≈Ñ
            </button>
            <button class="w-full bg-white dark:bg-white/10 dark:text-white py-4 rounded-[20px] font-bold text-slate-900 shadow-sm" onclick="closeHistory()">Zamknij</button>
        </div>
    </div>

    <script>
        let total = parseFloat(localStorage.getItem('total')) || 0;
        let goal = parseInt(localStorage.getItem('goal')) || 2500;
        let historyLog = JSON.parse(localStorage.getItem('historyLog')) || [];
        // Historia tygodniowa: { "2023-10-27": 2000, ... }
        let weeklyRecord = JSON.parse(localStorage.getItem('weeklyRecord')) || {};
        let notificationsEnabled = localStorage.getItem('notifications') === 'true';

        // --- IKONY ---
        const iconMap = {
            '1.0': 'üíß', '0.9': 'üßÉ', '0.85': '‚òï', '1.0_milk': '‚òïü•õ', '1.15_coco': 'ü••', '1.15_milk': 'ü•õ', 
            '0.9_energy': '‚ö°', '0.9_coke': 'ü•§', '0.98': 'üçµ', '0.6': 'üç∏',
            'fruit-banana': 'üçå', 'fruit-mandarin': 'üçä', 'fruit-kiwi': 'ü•ù',
            'fruit-apple': 'üçé', 'fruit-watermelon': 'üçâ', 'fruit-pineapple': 'üçç'
        };

        // --- DARK MODE ---
        function toggleTheme() {
            document.body.classList.toggle('dark');
            const isDark = document.body.classList.contains('dark');
            localStorage.setItem('theme', isDark ? 'dark' : 'light');
            updateThemeIcon(isDark);
        }

        function updateThemeIcon(isDark) {
            const icon = document.getElementById('theme-icon');
            icon.innerHTML = isDark 
                ? '<path stroke-linecap="round" stroke-linejoin="round" d="M12 3v2.25m6.364.386l-1.591 1.591M21 12h-2.25m-.386 6.364l-1.591-1.591M12 18.75V21m-4.773-4.227l-1.591 1.591M5.25 12H3m4.227-4.773L5.636 5.636M15.75 12a3.75 3.75 0 11-7.5 0 3.75 3.75 0 017.5 0z" />'
                : '<path stroke-linecap="round" stroke-linejoin="round" d="M21.752 15.002A9.718 9.718 0 0118 15.75c-5.385 0-9.75-4.365-9.75-9.75 0-1.33.266-2.597.748-3.752A9.753 9.753 0 003 11.25C3 16.635 7.365 21 12.75 21a9.753 9.753 0 009.002-5.998z" />';
        }

        if(localStorage.getItem('theme') === 'dark') { document.body.classList.add('dark'); updateThemeIcon(true); } else { updateThemeIcon(false); }

        // --- CHART & DATE LOGIC ---
        function getTodayKey() { return new Date().toISOString().split('T')[0]; }

        function saveDailyProgress() {
            weeklyRecord[getTodayKey()] = total;
            localStorage.setItem('weeklyRecord', JSON.stringify(weeklyRecord));
        }

        function renderChart() {
            const chartContainer = document.getElementById('weekly-chart');
            chartContainer.innerHTML = '';
            const days = ['Nd','Pn','Wt','≈ör','Cz','Pt','So'];
            
            for (let i = 6; i >= 0; i--) {
                const d = new Date();
                d.setDate(d.getDate() - i);
                const key = d.toISOString().split('T')[0];
                const val = weeklyRecord[key] || 0;
                // Obliczamy wysoko≈õƒá s≈Çupka (max 100%)
                let h = Math.round((val / goal) * 100);
                if(h > 100) h = 100;

                // Budowa s≈Çupka
                const barHtml = `
                <div class="flex flex-col items-center gap-1 w-full h-full justify-end">
                    <div class="chart-bar-bg w-full h-16 relative flex items-end">
                        <div class="chart-fill w-full" style="height: ${h}%"></div>
                    </div>
                    <span class="text-[9px] font-bold opacity-60">${days[d.getDay()]}</span>
                </div>`;
                chartContainer.innerHTML += barHtml;
            }
        }

        // --- NOTIFICATIONS ---
        function toggleNotifications() {
            const checkbox = document.getElementById('notif-toggle');
            if (checkbox.checked) {
                Notification.requestPermission().then(permission => {
                    if (permission === 'granted') {
                        notificationsEnabled = true;
                        localStorage.setItem('notifications', 'true');
                        // Testowe powiadomienie
                        new Notification("Powiadomienia w≈ÇƒÖczone! üíß", { body: "Bƒôdƒô Ci przypominaƒá o wodzie." });
                    } else {
                        checkbox.checked = false;
                        notificationsEnabled = false;
                        localStorage.setItem('notifications', 'false');
                        alert("Musisz zezwoliƒá na powiadomienia w przeglƒÖdarce.");
                    }
                });
            } else {
                notificationsEnabled = false;
                localStorage.setItem('notifications', 'false');
            }
        }
        
        // Ustaw stan switcha przy starcie
        document.getElementById('notif-toggle').checked = notificationsEnabled;

        // Sprawdzanie czasu dla powiadomie≈Ñ
        function checkNotifications() {
            if (!notificationsEnabled) return;
            const now = new Date();
            const hour = now.getHours();
            const min = now.getMinutes();
            const todayKey = getTodayKey();
            
            // Logika, aby powiadomienie wysz≈Ço raz dziennie (u≈ºywamy localStorage do trackowania wys≈Çania)
            
            // 9:00 RANO
            if (hour === 9 && min === 0) {
                const lastMorning = localStorage.getItem('lastMorningNotif');
                if (lastMorning !== todayKey) {
                    new Notification("Dzie≈Ñ dobry! ‚òÄÔ∏è", { body: "Zacznij dzie≈Ñ od szklanki wody. Tw√≥j cel to " + goal + "ml." });
                    localStorage.setItem('lastMorningNotif', todayKey);
                }
            }

            // 21:00 WIECZ√ìR
            if (hour === 21 && min === 0) {
                const lastEvening = localStorage.getItem('lastEveningNotif');
                if (lastEvening !== todayKey && total < goal && total > 0) {
                     new Notification("Jeste≈õ tak blisko! üåô", { body: "Brakuje Ci tylko " + (goal - Math.round(total)) + "ml do celu. Doko≈Ñcz to!" });
                     localStorage.setItem('lastEveningNotif', todayKey);
                }
            }
        }

        // Sprawdzaj co minutƒô
        setInterval(checkNotifications, 60000);


        // --- CORE FUNCTIONS ---
        function updateIconDisplay() {
            const select = document.getElementById('beverage');
            const selectedText = select.options[select.selectedIndex].text;
            const emoji = Array.from(selectedText)[0]; 
            document.getElementById('beverage-icon-display').innerText = emoji + (selectedText.startsWith('‚òïü•õ') ? 'ü•õ' : '');
        }

        document.getElementById('history-date').innerText = new Date().toLocaleDateString('pl-PL', {weekday: 'long', day: 'numeric', month: 'long'});

        function toggleHistory() { 
            renderChart(); // Od≈õwie≈º wykres przy otwieraniu
            renderHistory(); 
            document.getElementById('history-sheet').classList.toggle('show'); 
            document.getElementById('overlay').classList.remove('hidden'); 
        }
        function closeHistory() { document.getElementById('history-sheet').classList.remove('show'); document.getElementById('overlay').classList.add('hidden'); }

        function checkCustomAmount(select) {
            if (select.value === 'custom') {
                let n = prompt("Podaj ilo≈õƒá ml (max 10000):");
                if (n) {
                    let val = parseInt(n);
                    if (val > 10000) val = 10000;
                    if (val > 0) {
                        let opt = new Option(val, val);
                        select.add(opt, 0); select.value = val;
                    } else select.value = "250";
                } else select.value = "250";
            }
        }

        function setGoal() { 
            let n = prompt("Cel (ml) - max 10000:", goal); 
            if(n) { 
                let parsed = parseInt(n);
                if (parsed > 10000) parsed = 10000;
                goal = parsed; localStorage.setItem('goal', goal); update(); 
            } 
        }

        function checkAutoAdd() {
            const select = document.getElementById('beverage');
            const value = select.value;
            if (value.startsWith('fruit-')) {
                const option = select.options[select.selectedIndex];
                const fixedMl = parseFloat(option.getAttribute('data-ml'));
                executeAdd(value, fixedMl, true, select);
                setTimeout(() => { select.value = "1.0"; updateIconDisplay(); }, 500);
            }
        }
        
        function addDrink() {
            const select = document.getElementById('beverage');
            const value = select.value;
            if (value.startsWith('fruit-')) {
                const option = select.options[select.selectedIndex];
                executeAdd(value, parseFloat(option.getAttribute('data-ml')), true, select);
            } else {
                executeAdd(value, parseFloat(value), false, select);
            }
        }

        function executeAdd(typeKey, factorOrFixedMl, isFruit, selectElement) {
            let entryAmount, realHydration;
            if (isFruit) { entryAmount = factorOrFixedMl; realHydration = entryAmount; } 
            else {
                const currentAmt = parseInt(document.getElementById('amount-select').value);
                entryAmount = currentAmt; realHydration = currentAmt * factorOrFixedMl;
            }
            total += realHydration;
            const text = selectElement.options[selectElement.selectedIndex].text;
            const icon = Array.from(text)[0] + (text.startsWith('‚òïü•õ') ? 'ü•õ' : '');
            
            historyLog.unshift({ id: Date.now(), amount: entryAmount, icon: icon, hydration: realHydration, time: new Date().toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'}) });
            
            saveData(); update();
        }

        function resetAll() { if(confirm("Zresetowaƒá dzie≈Ñ?")) { total = 0; historyLog = []; saveData(); update(); closeHistory(); } }
        function deleteEntry(id) { 
            const idx = historyLog.findIndex(i => i.id === id); 
            if(idx > -1) { total -= historyLog[idx].hydration; if(total < 0) total = 0; historyLog.splice(idx, 1); saveData(); update(); renderHistory(); } 
        }

        function renderHistory() {
            const list = document.getElementById('history-list'); list.innerHTML = "";
            if(historyLog.length === 0) { list.innerHTML = "<div class='text-center text-sub mt-4 opacity-60'>Pusto... Wypij co≈õ! üíß</div>"; return; }
            historyLog.forEach(item => {
                const el = document.createElement('div');
                el.className = "history-item flex justify-between items-center bg-white/40 backdrop-blur-md p-4 rounded-[20px] border border-white/40 shadow-sm transition-colors";
                el.innerHTML = `<div class="flex items-center gap-4"><div class="history-item-icon w-10 h-10 bg-white/60 rounded-full flex items-center justify-center text-2xl shadow-sm">${item.icon}</div><div><div class="font-bold text-lg text-current">${item.amount} ml</div><div class="text-xs text-sub font-medium">${item.time}</div></div></div><div class="flex items-center gap-4"><span class="text-sm font-bold text-accent">+${Math.round(item.hydration)}</span><button onclick="deleteEntry(${item.id})" class="w-8 h-8 flex items-center justify-center text-sub hover:text-red-500 transition">‚úï</button></div>`;
                list.appendChild(el);
            });
        }

        function saveData() { 
            localStorage.setItem('total', total); 
            localStorage.setItem('historyLog', JSON.stringify(historyLog)); 
            saveDailyProgress(); // Zapisz do wykresu
        }
        
        function update() {
            document.getElementById('total').innerText = Math.round(total);
            document.getElementById('display-goal').innerText = goal;
            const percentage = Math.round((total / goal) * 100);
            document.getElementById('percent-display').innerText = percentage;
            const p = Math.min(percentage, 100);
            document.getElementById('progress-fill').style.height = p + "%";
            
            // Sprawd≈∫ reset o p√≥≈Çnocy
            const lastDate = localStorage.getItem('lastDate');
            const today = getTodayKey();
            if(lastDate && lastDate !== today) {
                // Nowy dzie≈Ñ! Resetujemy, ale total z wczoraj jest ju≈º w weeklyRecord dziƒôki saveDailyProgress
                total = 0; historyLog = []; saveData();
            }
            localStorage.setItem('lastDate', today);
        }

        setInterval(() => { document.getElementById('clock').innerText = new Date().toLocaleTimeString([], {hour:'2-digit', minute:'2-digit'}); }, 1000);
        update(); updateIconDisplay();
    </script>
    <style> @keyframes blob { 0% { transform: translate(0px, 0px) scale(1); } 33% { transform: translate(30px, -50px) scale(1.1); } 66% { transform: translate(-20px, 20px) scale(0.9); } 100% { transform: translate(0px, 0px) scale(1); } } .animate-blob { animation: blob 7s infinite; } .animation-delay-2000 { animation-delay: 2s; } .animation-delay-4000 { animation-delay: 4s; } </style>
</body>
</html>
